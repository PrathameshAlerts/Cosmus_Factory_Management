{% extends 'product/base.html' %}
{% load static %}
{% block body %}

<div class="mt-3">
  <table id="data-table" class="table table-striped table-bordered table-hover">
    <thead class="name_absolute sticky-top" >
      <tr>
        <th>GRN No</th>
        <th>Challan</th>
        <th>Vendor</th>
        {% for key, value in headers.items %}
        <th>{{ value }}</th>
        {% endfor %}
        <th style="background-color: lightgreen;">Row Total</th>
      </tr>
    </thead>
    <tbody class="mainTableList">
      {% for row in data %}
      <tr>
        <td>{{ row.grn_no }}</td>
        <td>{{ row.challan }}</td>
        <td>{{ row.vendor }}</td>
        {% for key, value in headers.items %}
        <td data-key="{{ value }}">
          {% if row.product_sku == value %}
          {{ row.aprv_qty }}
          {% else %}
          -
          {% endif %}
        </td>
        {% endfor %}
        <td  style="background-color: lightgreen;" class="row-total text-danger ps-3 fw-bold"></td> <!-- Placeholder for row totals -->
      </tr>
      {% endfor %}
    </tbody>
    <tfoot>
      <tr>
        
        <th colspan="3" class="text-center">Total</th>
        {% for key, value in headers.items %}
        <th class="column-total" data-key="{{ value }}"></th>
        {% endfor %}
        <th style="background-color: lightgreen;"  id="grand-total"></th> <!-- Grand total cell -->
      </tr>
    </tfoot>
  </table>
</div>

<script>

$(document).ready(function () {
    const table = $('#data-table');

    // Calculate Row Totals
    table.find('tbody tr').each(function () {
        let rowTotal = 0;
        $(this).find('td[data-key]').each(function () {
            const value = parseInt($(this).text()) || 0;
            rowTotal += value;
        });
        $(this).find('.row-total').text(rowTotal); // Format to 2 decimal places
    });

    // Calculate Column Totals
    const columnTotals = {};
    table.find('td[data-key]').each(function () {
        const key = $(this).data('key');
        const value = parseInt($(this).text()) || 0;

        columnTotals[key] = (columnTotals[key] || 0) + value;
    });

    table.find('tfoot .column-total').each(function () {
        const key = $(this).data('key');
        const total = columnTotals[key] || 0;
        $(this).text(total); // Format to 2 decimal places
    });

    // Calculate Grand Total
    let grandTotal = 0;
    table.find('.row-total').each(function () {
        grandTotal += parseInt($(this).text()) || 0;
    });

    $('#grand-total').text(grandTotal); // Format to 2 decimal places
});
</script>







{% endblock body %}