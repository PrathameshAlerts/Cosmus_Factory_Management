{% extends 'product/base.html' %}
{% load static %}

{% block body %}
<div>
  <h2>Stock Transfer</h2>
  <form class="mt-5" action="" method="POST">
    {% csrf_token %}
    <div class="d-flex mb-3">
      <label for="" class="form-label px-2">Stock Voucher No:</label>
      <input type="number" class="item-select mx-3" value="" name="voucher_no" maxlength="50" required id="">
      <div class="ms-auto">
        <label for="" class="form-label px-2">Date:</label>
        <span>{{ current_date }}</span>
      </div>
    </div>
    <div class="d-flex mb-3">
      <div>
        <label for="" class="form-label px-2">Source Godown:</label>
        <p>(Transfer from)</p>
      </div>
      <div class=" d-flex mb-3">
        <select value="" class="item-select" name="source_godown" required id="id_source_godown">
          {% for godown in raw_godowns %}
          <option value="{{godown.id}}">{{godown.godown_name_raw}}</option>
          {% endfor %}
        </select>
      </div>
      <span class="pt-3 pe-3">To</span>
      <div>
        <label for="" class="form-label">Target Godown:</label>
        <p>(Transfer to)</p>
      </div>
      <div class=" d-flex mb-3">
        <select value="" class="item-select" name="target_godown" required id="id_target_godown">

          {% for godown in raw_godowns %}
          <option value="{{godown.id}}">{{godown.godown_name_raw}}</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <div class="">
      <table class="table table-striped table-hover table-responsive">
        <thead>
          <tr>
            <th>Item Name</th>
            <th>Color</th>
            <th>Shades</th>
            <th>QTY</th>
            <th>Per</th>
            <th>Remark</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <select class="item-select" required id="name">
              </select>
            </td>
            <td>
              <input list="per" id="color" class="item-select" readonly>
            </td>
            <td>
              <select class="item-select" required id="shades">
              </select>
            </td>
            <td>
              <input list="qty" id="quantity" class="item-select">
            </td>
            <td>
              <input list="per" id="per" class="item-select" readonly>
            </td>
            <td>
              used
            </td>
          </tr>
        </tbody>
      </table>
    </div>




    <input type="submit" class="create-btn mt-4" name="save" value="Save">
    <input type="submit" class="create-btn" name="save_and_add_another" value="Save and Add Another">
    <button type="button" class="create-btn"><a class="text-decoration-none text-white" href="">Return</a></button>
  </form>
</div>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


<script>
  
  $(document).ready(function () {
    $('#name').change(function () {
        sendAjax('/stocktransfer/', 'GET', { 'item_value': $(this).val() }, function (response) {
            $('#shades').empty();
            $('#per').val(response.item_per);
            $('#color').val(response.item_color);
            $.each(response.item_shades, function (key, value) {
                $('#shades').append('<option value="' + key + '">' + value + '</option>');
            });
        });
    });

    $('#id_source_godown').change(function () {
        sendAjax('/stocktransfer/', 'GET', { 'selected_godown_id': $(this).val() }, function (response) {
            $('#name').empty();
            $.each(response.items_in_godown, function (key, value) {
                $('#name').append('<option value="' + key + '">' + value + '</option>');
            });
        });
    });

    $('#shades').change(function () {
        var selectgodown = $('#id_source_godown').val();
        sendAjax('/stocktransfer/', 'GET', { 'selected_shade_id': $(this).val(), 'godown_id': selectgodown }, function (response) {
            $('#quantity').val(response.shade_quantity);
        });
    });

    function sendAjax(url, method, data, successCallback, errorCallback) {
        $.ajax({
            url: url,
            method: method,
            data: data,
            success: successCallback,
            error: function (xhr, errmsg, err) {
                console.log('Error sending value to the backend');
                if (errorCallback) errorCallback(xhr, errmsg, err);
            }
        });
    }
});
</script>

{% endblock body %}