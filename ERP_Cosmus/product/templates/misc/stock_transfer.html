{% extends 'product/base.html' %}
{% load static %}

{% block body %}
<div>
        <h2>Stock Transfer</h2>
      <form class="mt-5" action="" method="POST">
           {% csrf_token %}
           <div class="d-flex mb-3">
            <label for="" class="form-label px-2">Stock Voucher No:</label>
            <input type="number" class="item-select mx-3" value="" name="voucher_no" maxlength="50" required id="">
          
          <div class="ms-auto">
            <label for="" class="form-label px-2">Date:</label>
            <span>{{ current_date }}</span>
          </div>
        </div>
           
    <div class="d-flex mb-3">
      <div>
        <label for="" class="form-label px-2">Source Godown:</label>
        <p>(Transfer from)</p>
      </div>
        
        <div class=" d-flex mb-3">

          <select value="" class="item-select" name="source_godown" required id="id_source_godown">
     
            {% for godown in raw_godowns %}
            <option value="{{godown.id}}">{{godown.godown_name_raw}}</option>
           {% endfor %}
        
          </select> 
        </div>
        <span class="pt-3 pe-3">To</span>
        <div>
          <label for="" class="form-label">Target Godown:</label>
        <p>(Transfer to)</p>
        </div>
        <div class=" d-flex mb-3">
          <select value="" class="item-select" name="target_godown" required id="id_target_godown">
            
            {% for godown in raw_godowns %}
             <option value="{{godown.id}}">{{godown.godown_name_raw}}</option>
            {% endfor %}
          </select> 
        </div>
      </div>

        <div class="">
          <table class="table table-striped table-hover table-responsive">
            <thead>
              <tr>
                <th>Item Name</th>
                <th>Color</th>
                <th>Shades</th>
                <th>QTY</th>
                <th>Per</th>
                <th>Remark</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>


      <select class="item-select" required id="name">

        <option class="item-select" value=""></option>
             </select>

                  </td>
                  <td>
                    <input list="per" id="color" class="item-select" readonly>
                    </td>
                    <td>

                          <select class="item-select" required id="shades">

                            <option class="item-select" value=""></option>
                          
                                 </select>




                      </td>
                      <td>
                        <input list="qty" id="quantity" class="item-select">

                        </td>
                        <td>
                          <input list="per" id="per" class="item-select" readonly>
                          
                          </td>
                          <td>
                            <span>used</span>
                            </td>
              </tr>
            </tbody>
          </table>
        </div>
        

        

    <input type="submit" class="create-btn mt-4" name="save" value="Save">
    <input type="submit" class="create-btn" name="save_and_add_another" value="Save and Add Another">
   <button type="button" class="create-btn"><a class="text-decoration-none text-white" href="">Return</a></button>
   </form>
  </div>


  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  
<script>

  $(document).ready(function() {
    $('#name').change(function() {
        var item_value = $(this).val(); // Get the value of the selected option

        // Send selectedGodownId to the backend using AJAX
        $.ajax({
            url: '/stocktransfer/',
            method: 'GET',
            data: {
                'item_value': item_value
            },
            success: function(response) {
                // Handle success response from the backend
                console.log('Item Value sent to the backend successfully');
                console.log('item_value:',item_value)
                
                $('#shades').empty();


                //Populate the dropdown with options from the response
                var item_shades = response.item_shades;
                var item_per = response.item_per;
                var item_color = response.item_color;

                var itemperinput = document.querySelector('#per');
                var itemcolorinput = document.querySelector('#color');
                // Set the value of the input field to the item_color
                itemperinput.value = item_per;

                itemcolorinput.value = item_color
                
                // Iterate over the itemsInGodown and append options to html
                $.each(item_shades, function(key, value) {
                 $('#shades').append('<option value="'+key+'">'+value+'</option>');
              });

                
            },
            error: function(xhr, errmsg, err) {
                // Handle error
                console.log('Error sending value to the backend');
            }
        });
    });
});




$(document).ready(function() {
  $('#id_source_godown').change(function() {
      var selectedGodownId = $(this).val(); // Get the value of the selected option

      // Send selectedGodownId to the backend using AJAX
      $.ajax({
          url: '/stocktransfer/',
          method: 'GET',
          data: {
              'selected_godown_id': selectedGodownId
          },
          success: function(response) {
              // Handle success response from the backend
              console.log('Value sent to the backend successfully');

              $('#name').empty();
              // Populate the dropdown with options from the response
              var itemsInGodown = response.items_in_godown;
              console.log('Items in Godown:', itemsInGodown);
              
              // Iterate over the itemsInGodown and append options to html
              $.each(itemsInGodown, function(key, value) {
                $('#name').append('<option value="'+key+'">'+value+'</option>');
            });

              
          },
          error: function(xhr, errmsg, err) {
              // Handle error
              console.log('Error sending value to the backend');
          }
      });
  });
});



$(document).ready(function() {
  $('#shades').change(function() {
      var selectshadesid = $(this).val(); // Get the value of the selected option

      // Get the select element by its ID
      var selectgodown = document.getElementById('id_source_godown');

      // Get the selected value of the select element
      var selectedValueGodown = selectgodown.value;
      
      // Now you can use the selectedValue variable as needed
      console.log('Selected value godown:', selectedValueGodown);

      console.log(selectshadesid)
      // Send shade to the backend using AJAX
      $.ajax({
          url: '/stocktransfer/',
          method: 'GET',
          data: {
              'selected_shade_id': selectshadesid,
              'godown_id': selectedValueGodown
          },
          
          success: function(response) {
              // Handle success response from the backend
              console.log('Value of shade sent to the backend successfully');

              
              //Populate the dropdown with options from the response
              var shade_quantity = response.shade_quantity;
              console.log('Items in Godown:', shade_quantity);

              // Find the input field with the ID "quantity"
              var quantityInput = document.getElementById('quantity');

              // Set the value of the input field to shade_quantity
              quantityInput.value = shade_quantity;

          },
          error: function(xhr, errmsg, err) {
              // Handle error
              console.log('Error sending value to the backend');
          }
      });
  });
});

</script>

{% endblock body %}