{% extends 'misc/navbar_popup.html' %}
{% load static %} 

{% block body %} 
  <div>
     
      <form  id ="fabricFinishForm" action="" method="POST">
           {% csrf_token %}
           <h2 class="mb-3 mt-4">Create Fabric Finishes</h2> 
       <div class="d-flex">
      <label for="id_fabric_finish" class="item-form">Fabric Finishes:</label>
      <input type="text" class="item-select" value="{{ form.instance.fabric_finish }}" name="fabric_finish" maxlength="255" required id="id_fabric_finish">
    </div>

    <input type="submit" class="create-btn mt-4" name="save" value="Save">
   
  </div>

  <script>
    document.getElementById('fabricFinishForm').addEventListener('submit', async function(event) {
        event.preventDefault();  // Prevent the default form submission
    
    const form = event.target;
    const formData = new FormData(form);
  
    formData.append('save', 'Save');
    try {
        const response = await fetch(form.action, {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
            }
        });

        if (response.ok) {
            const data = await response.json();  // Await the response.json() call
           window.opener.postMessage(data, '*');
            window.close();
        } else {
            console.error('Failed to update GST.');
        }
    } catch (error) {
        console.error('Error:', error);
    }
      
    });
    </script>

{% endblock body %}