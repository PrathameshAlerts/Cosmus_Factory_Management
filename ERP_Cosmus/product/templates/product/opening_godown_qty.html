{% extends 'misc/navbar_popup.html' %}
{% load static %} 

{% block body %} 

<h2>Shade Name :</h2>

<form class="mt-5" action="" method="POST">
    {% csrf_token %}  

    <table id="tableItem" class="table table-striped table-hover">
        <thead>
            <tr>
                <th>Godown Name</th>
                <th>Opening Qty</th>
                <th>Rate</th>
                <th>Delete</th>
            </tr>
        </thead>
        <tbody class="mainTableList">
            {{formset.management_form}}
            {% for form in formset %}
            {{ form.id }}
            <tr>
                <td>
                    <select name="{{form.prefix}}-opening_godown_id" id="{{form.prefix}}-opening_godown_id" class="purchase-input godown-select">
                    {% if form.instance.id %}
                    <option value="{{form.instance.opening_godown_id.id}}">{{form.instance.opening_godown_id.godown_name_raw}}</option>
                    {% for godown in godowns %}
                    <option value="{{godown.id}}">{{godown.godown_name_raw}}</option>
                    {% endfor %}
                    {% elif not form.instance.id %}
                    <option value=""></option>
                    {% for godown in godowns %}
                    <option value="{{godown.id}}">{{godown.godown_name_raw}}</option>
                    {% endfor %}
                    {% endif %}
                </select>

                </td>

                <td>
                    <input type="number" class="purchase-amount" name="{{form.prefix}}-opening_quantity" value="{{form.instance.opening_quantity}}" id="{{form.prefix}}-opening_quantity">
                </td>
                <td>
                    <input type="number" class="purchase-amount" name="{{form.prefix}}-opening_rate" value="{{form.instance.opening_rate}}" id="{{form.prefix}}-opening_rate">
                </td>
                <td>
                    <input type="checkbox" name="{{form.prefix}}-DELETE" id="{{forms.prefix}}-DELETE">
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <div>
        <button type="button" class="create-btn ms-3 mb-3" id="addItemRow">Add +</button>
    </div>
   

    <input type="submit"  onsubmit="" class="create-btn ms-5 mt-4" name="save" value="Save">
</form>

<script>
   document.addEventListener('DOMContentLoadered',function(){
    const addItem = document.getElementById('addItemRow');
    const tableId = document.querySelector('#tableItem tbody');
    if(addItem && tableId){
        addItem.addEventListener('click',function(){
            const index = document.getElementById('id_opening_qty_TOTAL_FORMS');
            const indexValue = parseInt(index.value);
            const row = tableId.lastElementChild.cloneNode(true);

            const godownElement = row.querySelector('select[name="item_godown"]');
            godownElement.name = `shade_godown_items_set-${indexValue}-godown_id`;
            godownElement.id = `shade_godown_items_set-${indexValue}-godown_id`;
            
            const qtyElement = row.querySelector('input[name="opening_godown_qty"]');
            qtyElement.name = `shade_godown_items_set-${indexValue}-quantity`;
            qtyElement.id = `shade_godown_items_set-${indexValue}-quantity`;
            qtyElement.value = '';

            const rateElement = row.querySelector('input[name="opening_godown_rate"]');
            rateElement.name = `shade_godown_items_set-${indexValue}-rate`;
            rateElement.id = `shade_godown_items_set-${indexValue}-rate`;
            rateElement.value = '';

            const deleteElement = row.querySelector('input[name="delete"]');
            deleteElement.name = `shade_godown_items_set-${indexValue}-DELETE`;
            deleteElement.id = `shade_godown_items_set-${indexValue}-DELETE`;

            tableId.appendChild(row);
            index.value = indexValue + 1;

        })
    }

   })
</script>
{% endblock body %}