{% extends 'misc/navbar_popup.html' %}
{% load static %}
{% block body %}

<h3 class="mb-3">Add items to product</h3>
<div class="d-flex mb-3">
    <h5 class="me-5">Product Name : <span class="text-capitalize text-danger">{{product_name}}</span></h5>
    <h5>Product Color : <span class="text-capitalize text-danger">{{product_color}}</span></h5> 
   
</div>
   
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {{ formset.management_form }}
       
        <table class="table table-responsive table-striped table-bordered" id="productForm">
            <thead>
                <tr>
                    <th>No</th>
                    <th>Item Select</th>
                    <th>Selected Item</th>
                    <th>Delete</th>
                </tr>
            </thead>
           
            <tbody class="mainTableList">
                {% for form in formset %}
                {{ form.id }}
                <tr>
                    <td>{{forloop.counter}}</td>
                    <td>
                        <select class="custom-select" name="{{form.prefix}}-Item_pk" id="{{form.prefix}}-Item_pk">
                            
                            <option value="{{form.instance.Item_pk.id}}">{{form.instance.Item_pk.item_name}}</option>
                            {% for item in items %}
                            <option value="{{item.id}}">{{item.item_name}}</option>
                            {% endfor %}
                        </select>

                    </td>
                    <td> <input type="text" class="item-select me-3" name="{{form.prefix}}-product_item_name" value="{{form.instance.Item_pk.item_name}}"  maxlength="255" id="{{form.prefix}}-product_item_name" readonly></td>
                        <td><span class="delete-btn border-0 bg-transparent" style="cursor: pointer;"><i class="fa-solid fa-trash text-danger px-3 py-2 fs-6"><input type="checkbox" class="product_Item_deleteId px-2" style="display: none;"  name="{{form.prefix}}-DELETE" id="{{form.prefix}}-DELETE" value="" ></i></span></td>
                </tr>
                {% endfor %}
            </tbody>
            
        </table>
        
                
    <button type="button" class="add_btn" id="addForm">Add</button>  
    <input type="submit" class="add_btn" >
    </form>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Add event listener for change event on select elements with the 'custom-select' class
    document.querySelectorAll('.custom-select').forEach(function(select) {
        select.addEventListener('change', function() {
            var selectedOption = this.options[this.selectedIndex];
            var selectedText = selectedOption.text.trim();
            
            // Collect all input values into an array
            var inputValues = [];
            document.querySelectorAll('input[name^="product_2_item_through_table_set-"][name$="-product_item_name"]').forEach(function(input) {
                inputValues.push(input.value.trim());
            });
            
            // Check if selectedText is in the array of inputValues
            var matchFound = inputValues.includes(selectedText);
            
            // Change background color of selected option based on matchFound
            if (matchFound) {
                selectedOption.style.backgroundColor = 'red';
                //select.style.boreder = '1px solid red'; // Change background color to red
            } else {
                selectedOption.style.backgroundColor = ''; // Reset background color
            }
        });
    });
});


</script>



   
    {% endblock body %} 
